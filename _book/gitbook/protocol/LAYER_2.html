
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Layer 2 Â· TradeLayer Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Patrick Dugan">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tabs/bootstrap.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/custom.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="DERIVATIVES.html" />
    
    
    <link rel="prev" href="TRADE_TYPES.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction/OVERVIEW.html">
            
                <a href="../introduction/OVERVIEW.html">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../introduction/VISION.html">
            
                <a href="../introduction/VISION.html">
            
                    
                    Vision
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../introduction/CROSSCHAIN.html">
            
                <a href="../introduction/CROSSCHAIN.html">
            
                    
                    Cross-Chain
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Protocol</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="OP_RETURN_LAYER.html">
            
                <a href="OP_RETURN_LAYER.html">
            
                    
                    OP_Return Layer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="TRADE_TYPES.html">
            
                <a href="TRADE_TYPES.html">
            
                    
                    Trade Types
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.3" data-path="LAYER_2.html">
            
                <a href="LAYER_2.html">
            
                    
                    Layer 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="DERIVATIVES.html">
            
                <a href="DERIVATIVES.html">
            
                    
                    Derivatives
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="INSURANCE.html">
            
                <a href="INSURANCE.html">
            
                    
                    Insurance and Liquidation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="FEE.html">
            
                <a href="FEE.html">
            
                    
                    Fees
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="TOKENOMICS.html">
            
                <a href="TOKENOMICS.html">
            
                    
                    Vesting and Tokenomics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="MACRO.html">
            
                <a href="MACRO.html">
            
                    
                    Macro-economics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="COMPLIANCE.html">
            
                <a href="COMPLIANCE.html">
            
                    
                    Compliance
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">API Reference</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../api_reference/TRANSACTIONS.html">
            
                <a href="../api_reference/TRANSACTIONS.html">
            
                    
                    TradeLayer Transactions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../api_reference/API.html">
            
                <a href="../api_reference/API.html">
            
                    
                    Orderbook Service API Package
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../api_reference/WALLET.html">
            
                <a href="../api_reference/WALLET.html">
            
                    
                    Wallet Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../api_reference/ENDPOINTS.html">
            
                <a href="../api_reference/ENDPOINTS.html">
            
                    
                    TradeLayer Endpoints
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Layer 2</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="layer-2-model">Layer 2 Model</h3>
<p>The brilliant thing about the Lightning Network is that two signatures on a 2-of-2 multisig becomes an immediately binding consensus lock of a transaction, and that transaction doesn&#x2019;t need to be published immediately.The limiting factor of the Lightning Network is that the UTXO model, which very memory efficient to track with Merkelization, is a nightmare to route.Account-based tokens can simply be debited from address A and credited to address B with logic, whether a smart contract like on Ethereum or inline logic like in TradeLayer.Combining the two models means you can get fast consensus in a Bitcoin-like environment without relying on slow block confirmation, and it also means routing can be painless.</p>
<p>And so, we built Trade Channels.Trade Channels are a Layer 2 model based on the following 4 transaction types:</p>
<h2 id="commit">Commit</h2>
<p>Commiting tokens takes them out of the spendable model that they live in on-chain by default, and puts them into Layer 2 mode.The principle differences follow:</p>
<p>Tokens move from the Available column in the tally map to Channel
Tokens can be pledged to an address controlled by the user or a 2-of-2 multisig they share with a counterparty
Channels are recorded as having commit addresses and columns, A and B, which column a commiter is assigned is deterministic based on the sequence of the last letter of the address or the second to last in case of a tie and the third to last character in case of a rare double-tie.</p>
<h2 id="withdraw">Withdraw</h2>
<p>Withdraw transactions are issued from the address that originally Committed them to the layer 2 system, pulling them back, but only after a 7 block waiting period.This period gives time for a counterparty to detect the pending Withdraw and publish any co-signed trades or transfers that have already been agreed to, this prevents welching on trades.</p>
<p>The other major benefit of the Withdraw model is it decouples custody keys from trading keys.In other words, you can Commit tokens by building a transaction and signing it on an airgapped computer, copy the PBST string between screens to maintain the gap, and then later issue a Withdraw to pull the tokens back.Just like how centralized exchanges work, having various controls and the ability to shut-off API keys while the underlying funds are kept in something like Fireblocks, with a separate protocol for ordering withdrawals, TradeLayer brings this requirement for professional money management and better retail security to DeFi.</p>
<h2 id="transfer">Transfer</h2>
<p>Transfer is how the Layer 2 becomes flexible enough to hot-route capital around between any two channel addresses.Since it&#x2019;s relatively fast to spin up a new channel with a new counterparty, it&#x2019;s possible to also quickly build and present a valid Transfer tx to that new counterparty, either signed from your own wallet&#x2019;s address or pinging a counterparty to liberate funds.</p>
<h2 id="pnl-settle">PNL Settle</h2>
<p>Ok so we can put funds onto the layer 2 model, which is relevant because you hold this string ot withdraw it, freeing you to co-sign trades and overrule the withdrawal assuming you haven&#x2019;t published the trade immediately.And, you can flexibly transfer capital between channels to make this system work like an orderbook.What&#x2019;s left? To really make a layer 2 scale, you want to save on publishing transactions, just signing them is enough! You can zip trades around, opening and closing positions, booking profits and losses, all day long, just keep signing, your counterparty may be a market maker who is hedging as they sign with you, relying on the option of paying miner fees to publish the trade, but you&#x2019;re both happy to basically save lots of money and trade <strong>almost for free</strong>.That&#x2019;s scaling.</p>
<p>The PNL Settle transaction makes this possible.The Token and Contract Channel Trade transactions have an expiration block, usually a few blocks ahead of when they are made, this is to prevent abuse of Counterparty Value Adjustment, where the party holding the partially-signed trade might wait for seconds or minutes to co-sign, the partial signature is like a free option.Filtering against abusive traders can help, binding to a smart contract and enforcing a tighter time-limit based on NEAR&#x2019;s 300ms block interval could overkill the problem, but TradeLayer by default has the expiration parameter as a base.The PNL Settle includes as a parameter the txid of the transaction you <em>would</em> have published, if you publish the PNL Settle then that transaction would be invalid in TradeLayer&#x2019;s consensus logic, it&#x2019;s like txid blacklisting.</p>
<p>Therefore it&#x2019;s possible to refresh a transaction every few blocks by pinging back and forth and producing a PNL Settle and a new trade.You can ping pong like that all day long, keeping a position alive, or you can do a settle based on the price of a closing trade.Imagine you signed a long trade with a market maker, the market goes down, a few blocks pass, you PNL Settle a loss and make a new long trade at the mark price matching the PNL Settle&#x2019;s value, then the market keeps dumping, you dump the long, you make another PNL Settle neutralizing that 2nd trade and neglect to make a new trade.</p>
<p>By using base 94 ASCII encoding it&#x2019;s possible to crunch txid&#x2019;s down to 30 bytes and pack 2 of them in the OP_Return, meaning it&#x2019;s possible to neutralize the previous PNL Settle and the previous trade update.Don&#x2019;t want to keep trading, don&#x2019;t make a new transaction, instead add in to the OP_Return a mark price and an update flag to update the first txid of the latest trade and only invalidate the txid of the last PNL Settlement; this way each PNL Settlement is final and you don&#x2019;t need to hold on to tons of these to publish later.</p>
<p>This flexibility seems a bit complicated if you were keeping track of it by hand but it can all fit into wallet code and run seamlessly.In this way, we can potentially achieve insane levels of transaction throughput at ultra-low latencies with average protocol and miner fees approaching 0 as market makers do more flow with high frequency liquidity takers.It&#x2019;s a unique approach compared to the rest of DeFi with radical potential to provide market structure for global transactions, millions a day, even hundreds of millions.</p>
<p>And when you do publish, the fee is 0.5 bps.</p>
<p><em>Last updated: [10<em>7</em>2024]</em></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="TRADE_TYPES.html" class="navigation navigation-prev " aria-label="Previous page: Trade Types">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="DERIVATIVES.html" class="navigation navigation-next " aria-label="Next page: Derivatives">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Layer 2","level":"2.3","depth":1,"next":{"title":"Derivatives","level":"2.4","depth":1,"path":"protocol/DERIVATIVES.md","ref":"protocol/DERIVATIVES.md","articles":[]},"previous":{"title":"Trade Types","level":"2.2","depth":1,"path":"protocol/TRADE_TYPES.md","ref":"protocol/TRADE_TYPES.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","tabs","highlight","sharing","fontsettings","theme-default"],"styles":{"website":"styles/custom.css"},"pluginsConfig":{"search-pro":{"cutWordLib":"nodejieba","defineWord":[]},"tabs":{},"highlight":{},"sharing":{"all":["facebook","google","twitter","weibo","instapaper"],"facebook":true,"google":false,"instapaper":false,"twitter":true,"vk":false,"weibo":false},"fontsettings":{"family":"sans","size":2,"theme":"white"},"theme-default":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}}},"theme":"default","author":"Patrick Dugan","engines":{"gitbook":"3.2.3"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"TradeLayer Documentation","gitbook":"*","description":"Comprehensive guide to TradeLayer Protocol."},"file":{"path":"protocol/LAYER_2.md","mtime":"2024-10-09T13:50:33.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-12-09T19:03:25.992Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-tabs/bootstrap.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

